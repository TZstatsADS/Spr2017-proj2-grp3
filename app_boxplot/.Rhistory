shiny::runApp()
mortality_nation <- read.csv("../output/national_mortality.csv")
mortality_nation <- mortality_nation %>% mutate(disease = gsub('Mortality (from|with) ','', disease))
View(mortality_nation)
mortality_nation <- mortality_nation %>% mutate(disease = gsub('Mortality (from|with) ','', disease),
percentage = ratiototal*100)
View(mortality_nation)
mortality_nation <- mortality_nation %>%
mutate(disease = gsub('Mortality (from|with) ','', disease)) %>%
rename(percentage=ratiototal)
mortality_nation <- read.csv("../output/national_mortality.csv")
mortality_nation <- mortality_nation %>%
mutate(disease = gsub('Mortality (from|with) ','', disease)) %>%
rename(percentage=ratiototal)
View(mortality_nation)
runApp()
runApp()
cdi <- select(cdi.raw, YearStart,LocationAbbr, LocationDesc, Question, DataValueTypeID, DataValue, Stratification1)
cdi.raw <- read.csv("../data/CDI.csv")
questions <- levels(cdi.raw$Question)
mortality <- questions[c(116,117,118,119,120,121,122,40,164,165)]
cdi <- select(cdi.raw, YearStart,LocationAbbr, LocationDesc, Question, DataValueTypeID, DataValue, Stratification1)
cdi <- rename(cdi, year=YearStart, statesAbbr=LocationAbbr, states=LocationDesc, disease=Question, datatype=DataValueTypeID, deathpop=DataValue, class=Stratification1)
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease (stroke)','stroke', disease),
disease = gsub('Mortality from coronary heart disease','coronary heart disease', disease),
disease = gsub('Mortality from diseases of the heart','diseases of the heart', disease),
disease = gsub('Mortality from heart failure','heart failure', disease),
disease = gsub('Mortality from total cardiovascular disease','cardiovascular disease', disease),
disease = gsub('Mortality with chronic obstructive pulmonary disease as underlying or contributing cause among adults aged >=45 years',
'chronic obstructive pulmonary', disease))
View(cdi)
View(cdi)
cdi.mort <- cdi %>%
filter(disease=='stroke', disease=='coronary heart disease', disease=='diseases of the heart',
disease=='heart failure', disease=='cardiovascular disease', disease=='chronic obstructive pulmonary',
datatype == "Nmbr")
View(cdi.mort)
cdi.mort <- cdi %>%
filter(disease=='stroke'|disease=='coronary heart disease'| disease=='diseases of the heart'|
disease=='heart failure'| disease=='cardiovascular disease'|disease=='chronic obstructive pulmonary',
datatype == "Nmbr")
View(cdi.mort)
cdi.prev <- cdi %>%
filter(disease=="Current asthma prevalence among adults aged >= 18 years"|
disease=="Prevalence of chronic obstructive pulmonary disease among adults >= 18"|
disease=="Prevalence of chronic obstructive pulmonary disease among adults >= 45 years",
datatype == "CrdPrev")
as.numeric.factor <- function(x) {as.numeric(levels(x))[x]}
cdi.prev$deathpop <- as.numeric.factor(cdi.prev$deathpop)
cdi.prev <- mutate(cdi.prev,
ratio=deathpop)
cdi.mort$deathpop <- as.numeric.factor(cdi.mort$deathpop)
cdi.mort.gender <- filter(cdi.mort, class == "Overall" | class == "Female" | class == "Male")
cdi.prev.gender <- filter(cdi.prev, class == "Overall" | class == "Female" | class == "Male")
View(cdi.mort.gender)
population <- read.csv("../data/population.csv")
pop <- select(population, NAME, POPESTIMATE2010:POPESTIMATE2014)
pop <- rename(pop, states=NAME, population=POPESTIMATE2010, population=POPESTIMATE2011, population=POPESTIMATE2012,
population=POPESTIMATE2013, population=POPESTIMATE2014)
pop <- pop[c(1,6:57), ]
# add population to cdi
cdi_2010 <- filter(cdi.mort.gender,year==2010)
cdi_2010_prev <- filter(cdi.prev.gender,year==2010)
pop_2010 <- pop[ ,c(1,2)]
cdi.pop.2010 <- merge(cdi_2010, pop_2010, by.x = "states")
cdi.pop.2010_prev <- merge(cdi_2010_prev, pop_2010, by.x = "states")
cdi_2011 <- filter(cdi.mort.gender,year==2011)
cdi_2011_prev <- filter(cdi.prev.gender,year==2011)
pop_2011 <- pop[ ,c(1,3)]
cdi.pop.2011 <- merge(cdi_2011, pop_2011, by.x = "states")
cdi.pop.2011_prev <- merge(cdi_2011_prev, pop_2011, by.x = "states")
cdi_2012 <- filter(cdi.mort.gender,year==2012)
cdi_2012_prev <- filter(cdi.prev.gender,year==2012)
pop_2012 <- pop[ ,c(1,4)]
cdi.pop.2012 <- merge(cdi_2012, pop_2012, by.x = "states")
cdi.pop.2012_prev <- merge(cdi_2012_prev, pop_2012, by.x = "states")
cdi_2013 <- filter(cdi.mort.gender,year==2013)
cdi_2013_prev <- filter(cdi.prev.gender,year==2013)
pop_2013 <- pop[ ,c(1,5)]
cdi.pop.2013 <- merge(cdi_2013, pop_2013, by.x = "states")
cdi.pop.2013_prev <- merge(cdi_2013_prev, pop_2013, by.x = "states")
cdi_2014 <- filter(cdi.mort.gender,year==2014)
cdi_2014_prev <- filter(cdi.prev.gender,year==2014)
pop_2014 <- pop[ ,c(1,6)]
cdi.pop.2014 <- merge(cdi_2014, pop_2014, by.x = "states")
cdi.pop.2014_prev <- merge(cdi_2014_prev, pop_2014, by.x = "states")
cdi.pop <- rbind(cdi.pop.2010, cdi.pop.2011, cdi.pop.2012, cdi.pop.2013, cdi.pop.2014)
cdi.pop.prev <- rbind(cdi.pop.2010_prev, cdi.pop.2011_prev, cdi.pop.2012_prev, cdi.pop.2013_prev, cdi.pop.2014_prev)
# add a new colum to cdi.pop: the ratio of death among population
cdi.pop <- mutate(cdi.pop,
ratio = 100*deathpop/population)
# We want to get the national mortality of different gender
# but the raw data here only has the national mortality of overall population
# remove the rows with "United States" in cdi.pop
# calculate the total national mortality according to gender
cdi.pop.new <- cdi.pop[cdi.pop$states!="United States", ]
national_mortality <- cdi.pop.new %>%
group_by(year, disease, class) %>%
select(deathpop, ratio) %>%
summarise(
deathtotal = sum(deathpop, na.rm=TRUE),
ratiototal = sum(ratio, na.rm=TRUE)
)
# write in csv file
write.csv(national_mortality, file = "../output/national_mortality.csv")
# get the clean state data with all info
cdi.state <- rbind(cdi.pop, cdi.pop.prev)
# write in csv file
write.csv(cdi.state,file = "../output/states disease prevalence and mortality.csv")
runApp()
mortality_nation <- read.csv("../output/national_mortality.csv")
mortality_nation <- mortality_nation %>%
rename(percentage=ratiototal)
DiseaseName <- unique(mortality_nation$disease)
DiseaseName
cdi <- select(cdi.raw, YearStart,LocationAbbr, LocationDesc, Question, DataValueTypeID, DataValue, Stratification1)
cdi <- rename(cdi, year=YearStart, statesAbbr=LocationAbbr, states=LocationDesc, disease=Question, datatype=DataValueTypeID, deathpop=DataValue, class=Stratification1)
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease (stroke)','stroke', disease),
disease = gsub('Mortality from coronary heart disease','coronary heart disease', disease),
disease = gsub('Mortality from diseases of the heart','diseases of the heart', disease),
disease = gsub('Mortality from heart failure','heart failure', disease),
disease = gsub('Mortality from total cardiovascular disease','cardiovascular disease', disease),
disease = gsub('Mortality with chronic obstructive pulmonary disease as underlying or contributing cause among adults aged >=45 years', 'chronic obstructive pulmonary', disease))
cdi <- rename(cdi, year=YearStart, statesAbbr=LocationAbbr, states=LocationDesc, disease=Question, datatype=DataValueTypeID, deathpop=DataValue, class=Stratification1)
cdi <- select(cdi.raw, YearStart,LocationAbbr, LocationDesc, Question, DataValueTypeID, DataValue, Stratification1)
cdi <- rename(cdi, year=YearStart, statesAbbr=LocationAbbr, states=LocationDesc, disease=Question, datatype=DataValueTypeID, deathpop=DataValue, class=Stratification1)
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease (stroke)','stroke', disease),
disease = gsub('Mortality from coronary heart disease','coronary heart disease', disease),
disease = gsub('Mortality from diseases of the heart','diseases of the heart', disease),
disease = gsub('Mortality from heart failure','heart failure', disease),
disease = gsub('Mortality from total cardiovascular disease','cardiovascular disease', disease),
disease = gsub('Mortality with chronic obstructive pulmonary disease as underlying or contributing cause among adults aged >=45 years', 'chronic obstructive pulmonary', disease))
cdi.mort <- cdi %>%
filter(disease=='stroke'|disease=='coronary heart disease'| disease=='diseases of the heart'|
disease=='heart failure'| disease=='cardiovascular disease'|disease=='chronic obstructive pulmonary',
datatype == "Nmbr")
View(cdi.mort)
cdi <- select(cdi.raw, YearStart,LocationAbbr, LocationDesc, Question, DataValueTypeID, DataValue, Stratification1)
cdi <- rename(cdi, year=YearStart, statesAbbr=LocationAbbr, states=LocationDesc, disease=Question, datatype=DataValueTypeID, deathpop=DataValue, class=Stratification1)
View(cdi)
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease \(stroke\)','stroke', disease))
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease [[:punc::] stroke [[:punc::] ','stroke', disease))
cdi <- cdi %>%
mutate(disease = gsub('[Mortality from cerebrovascular disease][[:punc::][stroke][[:punc::]','stroke', disease))
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease \\(stroke\\)','stroke', disease))
cdi <- cdi %>%
mutate(disease = gsub('Mortality from cerebrovascular disease \\(stroke\\)','stroke', disease),
disease = gsub('Mortality from coronary heart disease','coronary heart disease', disease),
disease = gsub('Mortality from diseases of the heart','diseases of the heart', disease),
disease = gsub('Mortality from heart failure','heart failure', disease),
disease = gsub('Mortality from total cardiovascular disease','cardiovascular disease', disease),
disease = gsub('Mortality with chronic obstructive pulmonary disease as underlying or contributing cause among adults aged >=45 years', 'chronic obstructive pulmonary', disease))
cdi.mort <- cdi %>%
filter(disease=='stroke'|disease=='coronary heart disease'| disease=='diseases of the heart'|
disease=='heart failure'| disease=='cardiovascular disease'|disease=='chronic obstructive pulmonary',
datatype == "Nmbr")
cdi.prev <- cdi %>%
filter(disease=="Current asthma prevalence among adults aged >= 18 years"|
disease=="Prevalence of chronic obstructive pulmonary disease among adults >= 18"|
disease=="Prevalence of chronic obstructive pulmonary disease among adults >= 45 years",
datatype == "CrdPrev")
as.numeric.factor <- function(x) {as.numeric(levels(x))[x]}
cdi.prev$deathpop <- as.numeric.factor(cdi.prev$deathpop)
cdi.prev <- mutate(cdi.prev,
ratio=deathpop)
cdi.mort$deathpop <- as.numeric.factor(cdi.mort$deathpop)
cdi.mort.gender <- filter(cdi.mort, class == "Overall" | class == "Female" | class == "Male")
cdi.prev.gender <- filter(cdi.prev, class == "Overall" | class == "Female" | class == "Male")
# load population
population <- read.csv("../data/population.csv")
pop <- select(population, NAME, POPESTIMATE2010:POPESTIMATE2014)
pop <- rename(pop, states=NAME, population=POPESTIMATE2010, population=POPESTIMATE2011, population=POPESTIMATE2012,
population=POPESTIMATE2013, population=POPESTIMATE2014)
pop <- pop[c(1,6:57), ]
# add population to cdi
cdi_2010 <- filter(cdi.mort.gender,year==2010)
cdi_2010_prev <- filter(cdi.prev.gender,year==2010)
pop_2010 <- pop[ ,c(1,2)]
cdi.pop.2010 <- merge(cdi_2010, pop_2010, by.x = "states")
cdi.pop.2010_prev <- merge(cdi_2010_prev, pop_2010, by.x = "states")
cdi_2011 <- filter(cdi.mort.gender,year==2011)
cdi_2011_prev <- filter(cdi.prev.gender,year==2011)
pop_2011 <- pop[ ,c(1,3)]
cdi.pop.2011 <- merge(cdi_2011, pop_2011, by.x = "states")
cdi.pop.2011_prev <- merge(cdi_2011_prev, pop_2011, by.x = "states")
cdi_2012 <- filter(cdi.mort.gender,year==2012)
cdi_2012_prev <- filter(cdi.prev.gender,year==2012)
pop_2012 <- pop[ ,c(1,4)]
cdi.pop.2012 <- merge(cdi_2012, pop_2012, by.x = "states")
cdi.pop.2012_prev <- merge(cdi_2012_prev, pop_2012, by.x = "states")
cdi_2013 <- filter(cdi.mort.gender,year==2013)
cdi_2013_prev <- filter(cdi.prev.gender,year==2013)
pop_2013 <- pop[ ,c(1,5)]
cdi.pop.2013 <- merge(cdi_2013, pop_2013, by.x = "states")
cdi.pop.2013_prev <- merge(cdi_2013_prev, pop_2013, by.x = "states")
cdi_2014 <- filter(cdi.mort.gender,year==2014)
cdi_2014_prev <- filter(cdi.prev.gender,year==2014)
pop_2014 <- pop[ ,c(1,6)]
cdi.pop.2014 <- merge(cdi_2014, pop_2014, by.x = "states")
cdi.pop.2014_prev <- merge(cdi_2014_prev, pop_2014, by.x = "states")
cdi.pop <- rbind(cdi.pop.2010, cdi.pop.2011, cdi.pop.2012, cdi.pop.2013, cdi.pop.2014)
cdi.pop.prev <- rbind(cdi.pop.2010_prev, cdi.pop.2011_prev, cdi.pop.2012_prev, cdi.pop.2013_prev, cdi.pop.2014_prev)
# add a new colum to cdi.pop: the ratio of death among population
cdi.pop <- mutate(cdi.pop,
ratio = 100*deathpop/population)
# We want to get the national mortality of different gender
# but the raw data here only has the national mortality of overall population
# remove the rows with "United States" in cdi.pop
# calculate the total national mortality according to gender
cdi.pop.new <- cdi.pop[cdi.pop$states!="United States", ]
national_mortality <- cdi.pop.new %>%
group_by(year, disease, class) %>%
select(deathpop, ratio) %>%
summarise(
deathtotal = sum(deathpop, na.rm=TRUE),
ratiototal = sum(ratio, na.rm=TRUE)
)
# write in csv file
write.csv(national_mortality, file = "../output/national_mortality.csv")
# get the clean state data with all info
cdi.state <- rbind(cdi.pop, cdi.pop.prev)
# write in csv file
write.csv(cdi.state,file = "../output/states disease prevalence and mortality.csv")
runApp()
runApp('E:/statistics/applied data science/Project2/Spr2017-proj2-grp3/app_boxplot')
